import{k as I,u,v as b}from"./chunk-WDYG26PG.js";import{$ as v,G as p,H as S,L as R,Q as f,Sb as l,Ub as A,Vb as x}from"./chunk-LC2BMWWT.js";import{a as d,b as m,d as t,e as h,f as c}from"./chunk-HPEDZGUO.js";var G=(()=>{var i,s,n,a;let o=class extends A{constructor(){super(...arguments);h(this,i,void 0);h(this,s,void 0);h(this,n,void 0);h(this,a,void 0);c(this,i,f(b)),c(this,s,f(x)),c(this,n,f(I)),c(this,a,e=>({next:r=>{t(this,s).setItem(u.user,r.user),this.patchState({user:r.user,isAuthenticated:!0}),this.selectors.errorResponse()&&this.patchState({errorResponse:null}),t(this,n).navigate(["/"])},error:r=>{this.patchState({errorResponse:r.error})},finalize:()=>{e.enable()}})),this.login=this.effect(p(e=>(e.disable(),t(this,i).login(e.getRawValue()).pipe(l(t(this,a).call(this,e)))))),this.register=this.effect(p(e=>(e.disable(),t(this,i).register(e.getRawValue()).pipe(l(t(this,a).call(this,e)))))),this.logout=this.effect(S(()=>{t(this,s).removeItem(u.user),this.patchState({isAuthenticated:!1,user:null}),t(this,n).navigate(["/login"])})),this.getCurrentUser=this.effect(p(()=>t(this,i).getCurrentUser().pipe(l(e=>{t(this,s).setItem(u.user,e.user),this.patchState({user:e.user})},e=>{console.error("Get Current User Failed",e),this.logout()})))),this.updateCurrentUser=this.effect(p(e=>(e.disable(),t(this,i).updateCurrentUser(e.getRawValue()).pipe(l({next:r=>{t(this,s).setItem(u.user,r.user),this.patchState({user:r.user})},error:r=>{console.error("error update",r)},finalize:()=>{e.enable()}}))))),this.resetErrorResponse=this.updater(e=>m(d({},e),{errorResponse:null}))}ngrxOnStoreInit(){let e=t(this,s).getItem(u.user);this.setState({isAuthenticated:!!e,user:e,errorResponse:null})}},g=o;return i=new WeakMap,s=new WeakMap,n=new WeakMap,a=new WeakMap,(()=>{o.\u0275fac=function(){let e;return function(C){return(e||(e=v(o)))(C||o)}}()})(),(()=>{o.\u0275prov=R({token:o,factory:o.\u0275fac})})(),g})();export{G as a};
